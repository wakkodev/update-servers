#!/bin/bash

CONFIG_FILE="/etc/v2ray/config.json"
PATH_LIST="/root/path"
TEMP_FILE="/tmp/config.json.tmp"

# Elegir un path aleatorio de path.dat
if [[ ! -f "$PATH_LIST" ]]; then
    echo "El archivo path.dat no existe"
    exit 1
fi

NEW_PATH=$(shuf -n 1 "$PATH_LIST")

if [[ -z "$NEW_PATH" ]]; then
    echo "No se pudo obtener un path válido"
    exit 1
fi

# Reemplazar el path en config.json
jq --arg newPath "$NEW_PATH" '
(.inbounds[]?.streamSettings?.wsSettings?.path) |= $newPath
' "$CONFIG_FILE" > "$TEMP_FILE" && mv "$TEMP_FILE" "$CONFIG_FILE"

# Reiniciar V2Ray para aplicar cambios
systemctl restart v2ray

echo "✅ Nuevo path aplicado: $NEW_PATH"
